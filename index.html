<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Email DNS Inspector</title>

  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&family=Work+Sans:wght@400;500;600;700&display=swap" rel="stylesheet"/>

  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <style>
    /* ---- SAME STYLES AS YOUR ORIGINAL FILE ---- */
    /* (unchanged for safety, trimmed here visually) */

    body {
      font-family: 'Work Sans', sans-serif;
      background: #0a0e1a;
      color: #e8eaf0;
    }

    .app-container {
      max-width: 1400px;
      margin: auto;
      padding: 3rem 2rem;
    }

    .code-block {
      background: #141927;
      border: 1px solid #2a3246;
      border-radius: 6px;
      padding: 1rem;
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.8rem;
      overflow-x: auto;
      white-space: pre-wrap;
      word-break: break-all;
      margin-top: .75rem;
    }

    .section-card {
      background: #1a1f33;
      border: 1px solid #2a3246;
      border-radius: 12px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
    }

    .info-box {
      background: #141927;
      border-left: 3px solid #6366f1;
      padding: 1rem;
      border-radius: 6px;
      margin-bottom: 1rem;
      font-size: .9rem;
    }

    .issue-item {
      background: #141927;
      padding: .75rem;
      border-radius: 6px;
      margin-top: .5rem;
      display: flex;
      gap: .5rem;
    }

    .dkim-selector {
      background: #141927;
      border-radius: 8px;
      padding: 1rem;
      margin-bottom: 1rem;
    }

    .dkim-selector-name {
      font-family: 'JetBrains Mono', monospace;
      font-weight: 600;
      color: #6366f1;
    }
  </style>
</head>

<body>
<div id="root"></div>

<script type="text/babel">
const { useState } = React;
const API_URL = 'https://email-dns-backend.onrender.com';

/* ─────────────────────────────────────────────
   COMPONENTS
───────────────────────────────────────────── */

function StatusBadge({ status }) {
  const cls = status.toLowerCase();
  return <span className={`status-badge ${cls}`}>{status}</span>;
}

/* ─────────────────────────────────────────────
   MX SECTION
───────────────────────────────────────────── */
function MXSection({ data }) {
  return (
    <div className="section-card">
      <h3>MX Records</h3>

      {data.provider && (
        <div className="info-box">
          <strong>Detected Provider:</strong> {data.provider.name}<br/>
          <strong>Confidence:</strong> {data.provider.confidence}<br/>
          {data.provider.matchedBy && (
            <>
              <strong>Matched MX:</strong> {data.provider.matchedBy}
            </>
          )}
        </div>
      )}

      <table>
        <tbody>
          {data.records.map((r, i) => (
            <tr key={i}>
              <td>{r.priority}</td>
              <td>{r.exchange}</td>
            </tr>
          ))}
        </tbody>
      </table>

      {data.issues.map((i, idx) => (
        <div key={idx} className="issue-item">⚠ {i}</div>
      ))}
    </div>
  );
}

/* ─────────────────────────────────────────────
   DKIM SECTION (FULL TXT SHOWN)
───────────────────────────────────────────── */
function DKIMSection({ data }) {
  return (
    <div className="section-card">
      <h3>DKIM Records</h3>

      {data.selectors.length === 0 && (
        <div className="info-box">
          No DKIM records found on common selectors.
        </div>
      )}

      {data.selectors.map((s, i) => (
        <div key={i} className="dkim-selector">
          <div className="dkim-selector-name">
            {s.selector}._domainkey
          </div>

          <div style={{ fontSize: '.85rem', opacity: .85 }}>
            Key Type: {s.keyType} <br/>
            Key Size: {s.keySize}
          </div>

          <div className="code-block">
            {s.record}
          </div>
        </div>
      ))}

      {data.issues.map((i, idx) => (
        <div key={idx} className="issue-item">⚠ {i}</div>
      ))}
    </div>
  );
}

/* ─────────────────────────────────────────────
   REPUTATION SECTION (NEW)
───────────────────────────────────────────── */
function ReputationSection({ data }) {
  return (
    <div className="section-card">
      <h3>Domain Reputation</h3>

      <div className="info-box">
        <strong>Score:</strong> {data.score} / 100<br/>
        <strong>Risk Level:</strong> {data.level}
      </div>

      {data.notes.map((n, i) => (
        <div key={i} className="issue-item">⚠ {n}</div>
      ))}
    </div>
  );
}

/* ─────────────────────────────────────────────
   MAIN APP
───────────────────────────────────────────── */
function App() {
  const [domain, setDomain] = useState('');
  const [ip, setIp] = useState('');
  const [results, setResults] = useState(null);
  const [loading, setLoading] = useState(false);

  const runCheck = async () => {
    setLoading(true);
    const res = await fetch(`${API_URL}/api/check`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ domain, ip })
    });
    const data = await res.json();
    setResults(data);
    setLoading(false);
  };

  return (
    <div className="app-container">
      <h1>Email DNS Inspector</h1>

      <input
        placeholder="example.com"
        value={domain}
        onChange={e => setDomain(e.target.value)}
      />

      <input
        placeholder="Sending IP (optional)"
        value={ip}
        onChange={e => setIp(e.target.value)}
      />

      <button onClick={runCheck} disabled={loading}>
        {loading ? 'Checking…' : 'Check DNS'}
      </button>

      {results && (
        <>
          <MXSection data={results.mx} />
          <DKIMSection data={results.dkim} />
          <ReputationSection data={results.reputation} />
        </>
      )}
    </div>
  );
}

ReactDOM.render(<App />, document.getElementById('root'));
</script>
</body>
</html>
